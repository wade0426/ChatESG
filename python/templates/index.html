<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>ChatESG</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../static/assets/favicon.ico">

    <!-- External CSS -->
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google fonts -->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic"
        rel="stylesheet" type="text/css">

    <!-- SimpleLightbox plugin CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/styles.css">
    <link rel="stylesheet" href="../static/my_bulma.css">
</head>

<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="#page-top">ChatESG</a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
                aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto my-2 my-lg-0">
                    <li class="nav-item"><a class="nav-link" href="#about">關於</a></li>
                    <li class="nav-item"><a class="nav-link" href="#services">技術</a></li>
                    <li class="nav-item"><a class="nav-link" href="#portfolio">幫助</a></li>
                    <li class="nav-item"><a class="nav-link" href="#contact">聯絡我們</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Masthead-->
    <header class="masthead">
        <div class="container px-4 px-lg-5 h-100">
            <div class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center">
                <div class="col-lg-8 align-self-end">
                    <h1 class="text-white font-weight-bold">您首選的 ESG 報告生成平台</h1>
                    <hr class="divider" />
                </div>
                <div class="col-lg-8 align-self-baseline">
                    <p class="text-white-75 mb-5">利用 AI 技術，幫助您輕鬆生成精確的 ESG 報告！只需輸入關鍵數據，
                        系統便會自動生成報告書，助您輕鬆應對合規要求並提升企業形象！點擊下方按鈕快速獲取量身定制的ESG報告書！
                    </p>
                    <a class="btn btn-primary btn-xl" href="#question">立即開始！</a>
                </div>
            </div>
        </div>
    </header>



    <!-- 問題-->
    <section class="page-section" id="question" style="background-color: lightslategray; padding-bottom: 5%;">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-8 text-center">
                    <h2 class="text-white mt-0">讓我們先了解你！</h2>
                    <hr class="divider divider-light" />
                    <p class="text-white-75" style="font-size: 150%; margin-bottom: 0%;">你想要製作哪一個產業類別的ESG報告書?</p>

                    <!-- button -->
                    <div class="btn-group" style="margin: 3%;">
                        <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            選擇你的產業類別
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#about" id="industry-finance">金融業</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-education">教育</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-food">食品工業</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-electric">電器電纜</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-machinery">電器機械</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-biotech">生技醫療</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-textile">紡織纖維</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-chemical">化學工業</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-plastic">塑膠工業</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-cement">水泥工業</a></li>
                            <li><a class="dropdown-item" href="#about" id="industry-glass">玻璃陶瓷</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#" id="industry-general">通用</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- About-->
    <section class="page-section" id="about" style="background-color: lightslategray; display: none; padding-top: 5%;">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-8 text-center">
                    <h2 class="text-white mt-0">讓我們生成更符合您所需要的報告！</h2>
                    <hr class="divider divider-light" />

                    <!-- 輸入表單 -->
                    <div id="industry-form" style="display: none;">
                        <div id="form-fields">
                            <!-- 動態生成的表單字段將在這裡 -->
                        </div>
                        <button type="button" class="btn btn-primary btn-sm mb-3 add-group btn-xl"
                            style="padding: 1% 5% 1% 5%;">添加新資料</button>
                    </div>
                    <br>
                    <a style="display: none; border-radius: 10rem; padding: 2.5% 6% 2.5% 6%; "
                        class="btn btn-primary btn-light" href="#contact" id="about_next">下一步！</a>
                </div>
            </div>
        </div>
    </section>
    <!-- Services-->
    <section class="page-section" id="services" style="background-color: bisque; display: none;">
        <div class="container px-4 px-lg-5">
            <h2 class="text-center mt-0">技術</h2>
            <hr class="divider" />
            <div class="row gx-4 gx-lg-5">
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-gem fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Sturdy Themes</h3>
                        <p class="text-muted mb-0">Our themes are updated regularly to keep them bug free!</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-laptop fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Up to Date</h3>
                        <p class="text-muted mb-0">All dependencies are kept current to keep things fresh.</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-globe fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Ready to Publish</h3>
                        <p class="text-muted mb-0">You can use this design as is, or you can make changes!</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 text-center">
                    <div class="mt-5">
                        <div class="mb-2"><i class="bi-heart fs-1 text-primary"></i></div>
                        <h3 class="h4 mb-2">Made with Love</h3>
                        <p class="text-muted mb-0">Is it really open source if it's not made with love?</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="page-section" id="contact" style="background-color: floralwhite; display: none;">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-8 col-xl-6 text-center">
                    <h2 class="mt-0">輸入你想要製作的章節！</h2>
                    <hr class="divider" />
                    <p class="text-muted mb-5">請詳細的輸入以下資訊！</p>
                </div>
            </div>
            <div class="row gx-4 gx-lg-5 justify-content-center mb-5">
                <div class="col-lg-6">
                    <form id="contactForm" data-sb-form-api-token="API_TOKEN">
                        <div id="form-groups">
                            <!-- 動態產生的表單群組將在這裡 -->
                        </div>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-xl btn-success --bs-teal" id="addGroup">添加新组</button>
                            <button class="btn btn-primary btn-xl" id="my_submitButton" type="submit">提交</button>
                        </div>

                        <div class="d-none" id="submitSuccessMessage">
                            <div class="text-center mb-3">
                                <div class="fw-bolder">填寫完成！</div>
                                正字生成內容。
                                <br />
                                <!-- <a -->
                                <!-- href="https://">https://</a> -->
                            </div>
                        </div>
                        <div class="d-none" id="submitErrorMessage">
                            <div class="text-center text-danger mb-3">Error sending message!</div>
                        </div>
                        <!-- Submit Button-->
                        <!-- <div class="d-grid"><button class="btn btn-primary btn-xl disabled" id="my_submitButton"
                                type="submit">提交</button></div> -->
                    </form>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer-->
    <footer class="bg-light py-5">
        <div class="container px-4 px-lg-5">
            <div class="small text-center text-muted">Copyright &copy; 2024 - NTCUST NLP Lab</div>
        </div>
    </footer>

    <!-- 測試p標籤 -->
    <p id="response"></p>

    <!-- Button trigger modal -->
    <button style="display: none;" id="wating_start-btn" type="button" class="btn btn-primary" data-bs-toggle="modal"
        data-bs-target="#staticBackdrop">
        開始等待
    </button>

    <!-- 等待 -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="justify-content: center;">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">AI生成中，請稍後...</h1>
                    <button style="display: none;" id="wating_cancel-btn" type="button" class="btn-close"
                        data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 外部庫 -->
    <!-- Bootstrap core JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SimpleLightbox plugin JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
    <!-- Bootstrap Forms JS -->
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>

    <!-- 本地腳本 -->
    <!-- Core theme JS -->
    <script src="../static/scripts.js"></script>
    <!-- (優先)引入formHandling.js -->
    <script src="/static/index_js/formHandling.js"></script>
    <!-- Custom prompt JS -->
    <script src="../static/index_js/prompt.js"></script>

    <!-- index.html 的 JS -->
    <script>


        // 當 DOM 加載完成後執行初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化表單處理
            initializeFormHandling();

            // 在這裡添加其他的事件監聽器或函數調用
            createGroup('關於本報告書', '', 'is-invalid', "");
            createGroup('長官的話', '', '', getPrompt('長官的話'));
            createGroup('關於公司', '', 'is-invalid', "");
            createGroup('永續發展策略', '', 'is-invalid', "");
            createGroup('公司治理', '', 'is-invalid', "");
            createGroup('永續金融', '', 'is-invalid', "");
            createGroup('永續環境', '', 'is-invalid', "");
            createGroup('員工關懷', '', 'is-invalid', "");

            // 驗證表單 是否為空
            validateForm();
        });



        // 用於傳送訊息到py
        // 傳送的訊息要包含 infoCount 和 groupCount 這個變數，以及每個群組的標題和內容
        // 請注意處理動態個 infoCount 和 groupCount因為使用者可能會新增或刪除
        // 需要修改這段函數，使其能夠傳送所有群組的標題和內容
        // 給py的資料 JSON 格式應該是這樣：{"infoCount":"X","groupCount":"X","資訊":{"公司名稱":"臺灣產物保險股份有限公司","成立時間":"1990年","報告年度":"2024年"},"章節":{"group1":{"title":"前言","content":"內容"},"group2":{"title":"關於公司","content":"內容"},"group3":{"title":"公司治理","content":"內容"}}}
        function sendMessage() {
            const formGroups = document.getElementById('form-groups');
            const groups = formGroups.querySelectorAll('.form-group');
            const formFields = document.getElementById('form-fields');
            const infoGroups = formFields.querySelectorAll('.form-group');

            let data = {
                infoCount: infoGroups.length,
                groupCount: groups.length,
                資訊: {},
                章節: {}
            };

            // 處理"資訊"部分
            infoGroups.forEach((group) => {
                const title = group.querySelector('input[type="text"]').value;
                const content = group.querySelector('textarea').value;
                data.資訊[title] = content;
                // console.log(data);

            });

            // 處理"章節"部分
            groups.forEach((group, index) => {
                const title = group.querySelector('input[type="text"]').value;
                const content = group.querySelector('textarea').value;
                data.章節[`group${index + 1}`] = {
                    title: title,
                    content: content
                };
                // console.log(data);
                localStorage.setItem('edit', JSON.stringify(data));
                // console.log(localStorage.getItem('edit'));
            });

            // console.log(data);

            fetch('/send_message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then(response => response.json())
                .then(data => {
                    // 關閉等待提示
                    document.getElementById('wating_cancel-btn').click();

                    // 測試p標籤
                    console.log(data);
                    document.getElementById('response').textContent = JSON.stringify(data, null, 2);

                    // 使用 LocalStorage
                    localStorage.setItem('response', JSON.stringify(data));

                    // 打開main頁面
                    // 打開main頁面
                    // 嘗試打開新頁面，如果被封鎖則在當前頁面導航
                    function openOrNavigate(url) {
                        const newWindow = window.open(url, '_blank');
                        if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                            // 彈出窗口被阻擋，在當前頁面導航
                            window.location.href = url;
                        }
                    }

                    // 打開main頁面
                    openOrNavigate('/main');

                    // 打開edit頁面
                    openOrNavigate('/edit');

                    // 關閉當前index頁面
                    // window.close();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // 監聽提交按鈕
        document.getElementById('my_submitButton').addEventListener('click', function (event) {
            event.preventDefault();  // 防止表單默認提交
            // 先檢查是否所有群組都有填寫標題和內容 不要有空字串""
            const formGroups = document.getElementById('form-groups');
            const groups = formGroups.querySelectorAll('.form-group');
            let valid = true;
            groups.forEach((group) => {
                const title = group.querySelector('input[type="text"]').value;
                const content = group.querySelector('textarea').value;
                if (title === '' || content === '') {
                    valid = false;
                }
            });
            if (!valid) {
                alert('請填寫所有群組的標題和內容！');
                return;
            }
            else {
                // alert('提交成功！');
                document.getElementById('wating_start-btn').click();

                // 將所有input標籤 和 text 加入disabled屬性，避免重複提交
                const inputs = document.querySelectorAll('input');
                const textareas = document.querySelectorAll('textarea');
                inputs.forEach((input) => {
                    input.disabled = true;
                });
                textareas.forEach((textarea) => {
                    textarea.disabled = true;
                });

                // console.log(valid);
                sendMessage();
            }
        });

        // about的產業類別選單
        document.addEventListener('DOMContentLoaded', function () {
            // 統計infoCount
            let infoCount = 0;
            const question_area = document.getElementById('question');
            const about_area = document.getElementById('about');
            const about_next = document.getElementById('about_next');
            const contact = document.getElementById('contact');

            const formFields = document.getElementById('form-fields');
            const addGroupButton = document.querySelector('.add-group');
            const industryForm = document.getElementById('industry-form');
            const dropdownItems = document.querySelectorAll('.dropdown-item');

            function createFormGroup(title = '', placeholder = '') {
                infoCount++;
                const group = document.createElement('div');
                group.className = 'form-group mb-3';
                group.innerHTML = `
                    <div class="form-floating mb-3">
                        <input class="form-control" id="title${Date.now()}" type="text" placeholder="Enter title..." value="${title}" required />
                        <label for="title${Date.now()}">標題</label>
                    </div>
                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="content${Date.now()}" placeholder="Enter content..." style="height: 10rem" required>${placeholder}</textarea>
                        <label for="content${Date.now()}">內容</label>
                    </div>
                    <button type="button" class="btn btn-danger btn-sm mb-3 delete-group">刪除</button>
                `;
                formFields.appendChild(group);

                group.querySelector('.delete-group').addEventListener('click', function () {
                    formFields.removeChild(group);
                });
            }

            function clearFormFields() {
                formFields.innerHTML = '';
            }

            function showIndustryForm() {
                industryForm.style.display = 'block';
            }

            dropdownItems.forEach(item => {
                item.addEventListener('click', function (event) {
                    event.preventDefault();
                    clearFormFields();
                    showIndustryForm();

                    // 移除 display: none 的屬性
                    question_area.style.paddingBottom = '0%';
                    about_next.style.display = 'math';
                    about_area.style.display = 'block';
                    contact.style.display = 'block';


                    // 去 #contact
                    window.location.href = "#about";

                    const industry = this.id.split('-')[1];
                    if (industry === 'finance') {
                        createFormGroup('公司名稱', "填寫您的公司名稱，例如：「臺灣產物保險股份有限公司」或「國泰金控」。");
                        createFormGroup('成立時間', "填寫您的公司成立時間，例如：「1990年」。");
                        createFormGroup('報告年度', "填寫您的公司報告年度，例如：「2024年」。");
                        createFormGroup('公司簡介', "提供公司的簡要介紹，包括核心業務領域。例如：「臺灣產物保險股份有限公司是全台歷史最悠久的產物保險公司，致力於提供客戶多元且創新的保險產品及服務。」");
                        createFormGroup('董事會與管理層', "提供董事會成員和管理層的簡介，包括他們的背景和在公司的角色。例如：「本公司董事會由七名資深董事組成，皆具有豐富的金融業經驗，並由總經理領導管理團隊。」");
                        createFormGroup('公司願景與使命', "描述公司長遠的發展願景以及現階段的使命。例如：以『穩健經營、客戶導向』為核心策略，致力於成為亞太地區最具影響力的金融機構。");
                        createFormGroup('核心價值觀', "列出公司堅持的核心價值觀，這些價值觀如何指導公司的決策和行為。例如：「誠信、創新、客戶至上、永續發展。」");
                        createFormGroup('產品與服務', "描述公司提供的主要產品和服務，包括市場定位和特色。例如：「臺灣產物保險提供車險、住宅保險、企業財產保險等多元產品，並致力於創新發展綠能保險。」");
                        createFormGroup('市場地位', "提供公司在市場中的地位和競爭優勢，如市場份額或領先優勢。例如：「本公司在台灣產險市場的市占率達到20%，位居市場前列。」");
                        createFormGroup('營運績效', "概述公司的財務和非財務績效，重點包括主要的財務指標，如收入、利潤、資產負債比等。例如：「2022年資本額為36.22億元，風險資本適足率達1081.89%」。");
                        createFormGroup('稅務管理', "說明公司在稅務遵循和稅務透明度方面的做法，包括如何確保適當的稅務策略和合規。");
                        createFormGroup('關鍵成就與獎項', "列出公司在報告年度內的關鍵成就和獲得的獎項，例如：「榮獲金管會2022年度公平待客評核結果為產險業排名前25%之績優金融機構」。");
                        createFormGroup('永續發展委員會設立', "永續經營委員會設立 本行於董事會下設置「永續經營委員會」");
                        createFormGroup('永續發展委員會成員', '永續經營委員會成員 由董事長擔任召集人，加上三位獨立董事及總經理組成')
                        createFormGroup('永續發展委員會職責', '負責推動永續發展價值納入經營政策、協調建立相關制度、督導檢視政策之執行情形及其成效，定期審核相關執行報告')
                        createFormGroup('永續發展政策和守則', '本司承諾持續呼應 SDGs 永續發展政策，並訂定5大政策議題「公司治理」、「責任金融」、「員工照護」、「社會共融」及「環境永續」，以兼顧企業業務成長、利害關係人權益，以及環境與社會的永續發展。')
                        createFormGroup('永續發展措施', "填寫公司在環境保護、社會參與及公司治理等方面的具體措施，例如：「推動數位E化作業及車險保單無紙化」。例如：「公司制定綠色低碳運營模式，推動能資源耗損的減少及高耗能設備的汰換。」");
                        createFormGroup('社會責任行動', "填寫公司在社會責任方面的具體行動如慈善活動、社區關懷或其他公益舉措，例如：「成立臺灣產物保險文教基金會，支持青少年校園反毒宣導」。例如：「臺灣產物保險文教基金會多年來積極關懷弱勢群體，推動婦女與獨居老人的照顧計畫。」");
                        createFormGroup('永續經營理念', "本司致力於推動永續經營理念，致力於實踐企業社會責任，秉持著環保、社會責任與公司治理三大核心價值，將其融入到日常經營活動中，確保企業長期穩健發展，為環境保護和社會進步貢獻力量。");
                        createFormGroup('減碳成效', "本司積極響應國際減碳趨勢，於 2022 年取得 ISO14064-1 溫室氣體排放量盤查證書，並完成所有國內、海外據點及子公司的盤查，展現我們邁向淨零排放的決心。同時，我們積極推動綠色金融，將 ESG 因素納入授信評估，引導資金投入永續發展領域，積極推動低碳轉型。");
                        createFormGroup('未來承諾', "填寫公司未來的計劃和面臨的挑戰，例如：「面對氣候變遷及資安威脅，將加速跨界交流與加深協作能力」。");
                    }
                    else if (industry === 'education') {
                        createFormGroup('學校名稱', "填寫您的學校名稱，例如：「國立臺中科技大學」或「國立臺灣大學」。");
                        createFormGroup('課程', "");
                    }
                    else {
                        createFormGroup();
                    }
                });
            });

            addGroupButton.addEventListener('click', () => createFormGroup());
        });

    </script>
</body>

</html>